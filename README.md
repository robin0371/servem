# Приложение "Эмулятор программно-аппаратной системы"


### Что это?
Это программа - эмулятор программно-аппаратной системы, который содержит эмулятор устройств, эмулятор серверов и маршрутизирующий прокси-сервер.


### Технологии
Python 3.5


### Установка зависимостей
```sh
$ source .virtualenvs/bin/activate
$ cd /path/to/servem
$ pip install -r requirements.txt
```


### Запуск
```sh
$ source .virtualenvs/bin/activate
$ cd /path/to/servem
$ python __main__.py --settings=config.yaml -d terminal_1 terminal_2 terminal_3 -i 127.0.0.1 127.0.0.1 127.0.0.1 -p 8888 8888 9999 -sp 8888 9999
```

Где в:
--settings, указывается путь до файла настроек
-d или --device_id, указываются id устройств
-i или --ip, указываются IP-адреса устройств в порядке указанном в ключе -d
-p или --port, указываются порты устройств в порядке указанном в ключе -d
-sp или --server_port, указываются порты серверов

В команде выше, запустятся 3 терминала, которые будут отправлять свой статус на хост 127.0.0.1,
terminal_1 и terminal_2 на порт 8888, а terminal_3 на порт 9999, и будут запущены 2 локальных
сервера на портах 8888 и 9999.



### Описание
  - Эмуляторы устройств:
    - После запуска, периодически отправляют свой статус на сервер:
        POST /status/

            {
                "device_id": “<идентификатор устройства, string>”,
                “request_id”: “<идентификатор запроса, string>”,
                "status": "OK",
                "data": {
                    <произвольный объект с данными>
                }
            }
    - Идентификаторы устройств, ip-адрес и порт сервера задаются
    через аргументы командной строки.


  - Прокси-сервер, маршрутизирует запросы между эмуляторами сервера, в
    зависимости от идентификатора устройства в теле запроса и делает это по
    таблице соответствия описываемой в config.yaml


  - Эмулятор сервера:
    - Отвечает на все корректные по структуре запросы следующим json:

            {
                "device_id": “<идентификатор устройства, string>”,
                “request_id”: “<идентификатор запроса, string>”,
                "result": "OK"
            }