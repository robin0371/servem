# Приложение "Эмулятор программно-аппаратной системы"


### Что это?
Это программа - эмулятор программно-аппаратной системы, который содержит эмулятор устройств, эмулятор серверов и маршрутизирующий прокси-сервер.


### Технологии
Python 3.5


### Установка зависимостей
```sh
$ source .virtualenvs/bin/activate
$ cd /path/to/servem
$ pip install -r requirements.txt
```


### Запуск

#### Запуск proxy, для маршрутизации
```sh
$ source .virtualenvs/bin/activate
$ cd /path/to/servem
$ python proxy.py --settings=config.yaml -ht 127.0.0.1 -p 7777
```

* Где в:
  * --settings, указывается путь до файла настроек
  * -ht или --host, указывается хост proxy-сервера
  * -p или --port, указываются порт proxy-сервера

В команде выше, запустится сервер 127.0.0.1:7777, который будет маршрутизировать запросы
по схеме, настраиваемой в параметре MAP, в config.yaml

#### Запуск эмуляции серверов приложений
```sh
$ source .virtualenvs/bin/activate
$ cd /path/to/servem
$ python server.py --settings=config.yaml -sp 8080 -plp 8090 -pp 9000
```

* Где в:
  * --settings, путь до файла настроек
  * -sp или --staging_port, порт сервера для разработки
  * -plp или --production_like_port, порт сервера для регрессионного тестирования
  * -pp или --production_port, порт продакшен-сервера

В команде выше, запустятся 3 локальных сервера(с приложениями для приема статусов запросов)
на портах 8080, 8090 и 9000 и сервер по-умолчанию, который настраивается в config.yaml

#### Запуск эмуляции системы устройств
```sh
$ source .virtualenvs/bin/activate
$ cd /path/to/servem
$ python client.py --settings=config.yaml -d terminal_0 terminal_5 terminal_25 -ht 127.0.0.1 -p 7777
```

* Где в:
  * --settings, путь до файла настроек
  * -d или --devices_id, id устройств (ID устройства должно содержать _ и после этого символа должен быть номер устройства)
  * -ht или --host, сервер, на который устройства передают свой статус
  * -p или --port, порт, на который устройства передают свой статус

В команде выше, запустятся 3 устройства с id terminal_0, terminal_5, terminal_25.
После запуска, устройства начнут периодическую отправку своего статуса на сервер 127.0.0.1:7777


### Описание
  - Эмуляторы устройств:
    - После запуска, периодически отправляют свой статус на сервер:
        POST /status/

            {
                "device_id": "<идентификатор устройства, string>",
                "request_id": "<идентификатор запроса, string>",
                "status": "OK",
                "data": {
                    <произвольный объект с данными>
                }
            }
    - Идентификаторы устройств, ip-адрес и порт сервера задаются
    через аргументы командной строки.


  - Прокси-сервер, маршрутизирует запросы между эмуляторами сервера, в
    зависимости от идентификатора устройства в теле запроса и делает это по
    таблице соответствия описываемой в config.yaml


  - Эмулятор сервера:
    - Отвечает на все корректные по структуре запросы следующим json:

            {
                "device_id": "<идентификатор устройства, string>",
                "request_id": "<идентификатор запроса, string>",
                "result": "OK"
            }